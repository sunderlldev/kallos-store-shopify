<section class="kallos-editorial">
  <div class="kallos-editorial-wrapper">
    <div class="kallos-editorial-header">
      {% if section.settings.title != blank %}
        <h2 class="kallos-editorial-title">{{ section.settings.title }}</h2>
      {% endif %}
      
      {% if section.settings.subtitle != blank %}
        <p class="kallos-editorial-subtitle">{{ section.settings.subtitle }}</p>
      {% endif %}
    </div>

    {% if section.settings.collection != blank and section.settings.collection.products_count > 0 %}
      <div class="kallos-carousel">
        <button class="kallos-chevron kallos-prev" aria-label="Anterior">‹</button>
        <div class="kallos-carousel-clip">
          <div class="kallos-editorial-grid">
            {% for product in section.settings.collection.products limit: 12 %}
              <a href="{{ product.url }}" class="kallos-card" draggable="false">
                <div class="kallos-card-media">
                  {% if product.images.size > 1 %}
                    {{
                      product.images[0]
                      | image_url: width: 600
                      | image_tag:
                        class: 'kallos-img kallos-img-main',
                        loading: 'lazy',
                        alt: product.title,
                        draggable: false
                    }}
                    {{
                      product.images[1]
                      | image_url: width: 600
                      | image_tag:
                        class: 'kallos-img kallos-img-hover',
                        loading: 'lazy',
                        alt: product.title,
                        draggable: false
                    }}
                  {% else %}
                    {{
                      product.featured_image
                      | image_url: width: 600
                      | image_tag:
                        class: 'kallos-img kallos-img-single',
                        loading: 'lazy',
                        alt: product.title,
                        draggable: false
                    }}
                  {% endif %}
                </div>

                <div class="kallos-card-content">
                  <div class="kallos-card-header">
                    <p class="kallos-card-title">{{ product.title }}</p>
                    <span class="kallos-card-price">{{ product.price | money }}</span>
                  </div>

                  <div class="kallos-card-description">
                    {{ product.description | strip_html | truncatewords: 15 }}
                  </div>

                  <div class="jdgm-prev-badge--static">
                    <span class="jdgm-prev-badge__stars">
                      {% for i in (1..5) -%}
                        <span class="jdgm-star"></span>
                      {%- endfor %}
                    </span>
                  </div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
        <button class="kallos-chevron kallos-next" aria-label="Siguiente">›</button>
      </div>
    {% endif %}
  </div>
</section>

<style>
  #shopify-section-{{ section.id }} {
    --kallos-card-bg: {{ section.settings.card_bg }};
    --title-weight: {{ section.settings.title_weight }};
    --subtitle-weight: {{ section.settings.subtitle_weight }};
    --price-weight: {{ section.settings.price_weight }};
  }

  .kallos-editorial { padding: 60px 0; overflow: hidden; background: #fff; }
  .kallos-editorial-wrapper { padding: 0 4vw; }
  
  .kallos-editorial-header { 
    text-align: center; 
    margin-bottom: 3rem; 
  }

  .kallos-editorial-title { 
    font-size: clamp(1.8rem, 4vw, 2.8rem); 
    margin: 0 0 0.5rem 0; 
    color: #000; 
    font-weight: var(--title-weight);
  }

  .kallos-editorial-subtitle {
    font-size: clamp(1rem, 2vw, 1.2rem);
    color: #666;
    margin: 0;
    font-weight: var(--subtitle-weight);
  }

  .kallos-carousel { position: relative; display: flex; align-items: center; width: 100%; }

  .kallos-carousel-clip {
    width: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 20px 0 40px;
    cursor: grab;
  }
  .kallos-carousel-clip::-webkit-scrollbar { display: none; }

  .kallos-editorial-grid {
    display: flex;
    gap: 20px;
    padding: 0 10px;
  }

  .kallos-card {
    flex: 0 0 calc(25% - 15px);
    scroll-snap-align: start;
    background: var(--kallos-card-bg);
    border-radius: 28px;
    text-decoration: none;
    color: #fff;
    display: flex;
    flex-direction: column;
    min-height: 520px;
    transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    user-select: none;
    overflow: hidden;
  }

  .kallos-card:hover { transform: translateY(-8px); }

  .kallos-card-media { position: relative; aspect-ratio: 1/1; overflow: hidden; }
  .kallos-img { width: 100%; height: 100%; object-fit: cover; }
  .kallos-img-hover { position: absolute; inset: 0; opacity: 0; transition: 0.4s; }
  .kallos-card:hover .kallos-img-hover { opacity: 1; }

  .kallos-card-content {
    padding: 24px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .kallos-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 10px;
  }

  .kallos-card-price {
    white-space: nowrap;
    font-weight: var(--price-weight);
    font-size: 1.1rem;
    flex-shrink: 0;
  }

  .kallos-card-title {
    margin: 0;
    font-size: 1.05rem;
    font-weight: 700; /* Puedes hacerlo dinámico si prefieres también para el producto */
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .kallos-card-description {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 15px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .kallos-chevron {
    position: absolute;
    top: 40%;
    z-index: 20;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: #fff;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
  }
  .kallos-prev { left: -15px; }
  .kallos-next { right: -15px; }

  @media (max-width: 1100px) {
    .kallos-card { flex: 0 0 calc(33.33% - 14px); min-height: 500px; }
  }

  @media (max-width: 768px) {
    .kallos-card { flex: 0 0 calc(50% - 10px); min-height: 480px; }
    .kallos-prev { left: -10px; }
    .kallos-next { right: -10px; }
    .kallos-chevron { width: 36px; height: 36px; font-size: 18px; }
  }

  @media (max-width: 480px) {
    .kallos-card { flex: 0 0 82vw; min-height: 460px; }
    .kallos-editorial-header { margin-bottom: 2rem; }
  }

  .jdgm-star {
    width: 14px; height: 14px; background: #fff; display: inline-block;
    mask: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3E%3C/svg%3E") no-repeat center;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const clip = document.querySelector('.kallos-carousel-clip');
    const next = document.querySelector('.kallos-next');
    const prev = document.querySelector('.kallos-prev');
    let autoScrollActive = true;

    if (!clip) return;

    const getScrollStep = () => {
      const card = clip.querySelector('.kallos-card');
      return card ? card.offsetWidth + 20 : 300;
    };

    const startAutoScroll = () => {
      return setInterval(() => {
        if (!autoScrollActive) return;
        const isAtEnd = clip.scrollLeft >= clip.scrollWidth - clip.clientWidth - 50;
        if (isAtEnd) {
          clip.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          clip.scrollBy({ left: getScrollStep(), behavior: 'smooth' });
        }
      }, 5000);
    };

    let scrollInterval = startAutoScroll();

    const stopInterval = () => {
      autoScrollActive = false;
      clearInterval(scrollInterval);
      setTimeout(() => {
        autoScrollActive = true;
        scrollInterval = startAutoScroll();
      }, 10000);
    };

    if (next) next.addEventListener('click', () => { clip.scrollBy({ left: getScrollStep(), behavior: 'smooth' }); stopInterval(); });
    if (prev) prev.addEventListener('click', () => { clip.scrollBy({ left: -getScrollStep(), behavior: 'smooth' }); stopInterval(); });

    clip.addEventListener('touchstart', stopInterval, { passive: true });
    clip.addEventListener('mousedown', stopInterval);
  });
</script>

{% schema %}
{
  "name": "Destacados editorial",
  "settings": [
    { "type": "collection", "id": "collection", "label": "Colección" },
    { "type": "text", "id": "title", "label": "Título", "default": "Lo más popular en Kallos Store" },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Grosor título",
      "default": "700",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medio" },
        { "value": "700", "label": "Negrita (Bold)" }
      ]
    },
    { "type": "text", "id": "subtitle", "label": "Subtítulo", "default": "Descubre nuestras últimas tendencias" },
    {
      "type": "select",
      "id": "subtitle_weight",
      "label": "Grosor subtítulo",
      "default": "400",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medio" },
        { "value": "700", "label": "Negrita (Bold)" }
      ]
    },
    {
      "type": "select",
      "id": "price_weight",
      "label": "Grosor precio",
      "default": "600",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "600", "label": "Semibold" },
        { "value": "700", "label": "Negrita (Bold)" }
      ]
    },
    { "type": "color", "id": "card_bg", "label": "Fondo Card", "default": "#AC9651" }
  ],
  "presets": [{ "name": "Destacados editorial" }]
}
{% endschema %}