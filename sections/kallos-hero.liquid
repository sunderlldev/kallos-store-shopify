<section class="kh-section" id="kh-hero-{{ section.id }}">
  <div class="kh-container">
    <div class="kh-media-col">
      <div class="kh-composite-wrapper">
        {% if section.settings.img_main %}
          <div class="kh-main-wrapper">
            {{
              section.settings.img_main
              | image_url: width: 900
              | image_tag: class: 'kh-img kh-img--main', loading: 'lazy'
            }}
          </div>
        {% endif %}

        {% if section.settings.img_secondary %}
          <div class="kh-secondary-wrapper">
            {{
              section.settings.img_secondary
              | image_url: width: 700
              | image_tag: class: 'kh-img kh-img--secondary', loading: 'lazy'
            }}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="kh-text-col">
      <div class="kh-proof-badge">
        <div class="kh-stars">
          {% for i in (1..5) %}
            <svg fill="currentColor" viewBox="0 0 256 256">
              <path d="m234.29 114.85-45 38.83L203 211.75a16.4 16.4 0 0 1-24.5 17.82L128 198.49l-50.53 31.08A16.4 16.4 0 0 1 53 211.75l13.76-58.07-45-38.83A16.46 16.46 0 0 1 31.08 86l59-4.76 22.76-55.08a16.36 16.36 0 0 1 30.27 0l22.75 55.08 59 4.76a16.46 16.46 0 0 1 9.37 28.86Z"/>
            </svg>
          {% endfor %}
        </div>
        <div class="kh-clients-count">
          <strong>+{{ section.settings.client_count }}</strong> {{ section.settings.client_text }}
        </div>
      </div>

      <h1 class="kh-hero-title">
        <span class="kh-static-text">{{ section.settings.title_rich }}</span>
        <span class="kh-dynamic-wrapper">
          <span id="kh-typed-{{ section.id }}"></span><span class="kh-caret"></span>.
        </span>
      </h1>

      <div class="kh-hero-desc">
        {{ section.settings.description_rich }}
      </div>
    </div>
  </div>
</section>

<style>
  #kh-hero-{{ section.id }} {
    --bg-grad: {{ section.settings.gradient_color }};
    --text-color: {{ section.settings.text_color }};
    --star-color: {{ section.settings.star_color }};
    background-color: #f4f4f4; /* Fallback */
    color: var(--text-color);
    position: relative;
    overflow: hidden; /* Evita desborde en mobile */
    font-family: 'Poppins', sans-serif;
  }

  /* El degradado ahora va de izquierda a derecha para favorecer el texto */
  #kh-hero-{{ section.id }}::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, var(--bg-grad) 0%, transparent 100%);
    z-index: 0;
  }

  .kh-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 80px 20px;
    display: flex;
    flex-direction: row-reverse; /* Imagen Izquierda, Texto Derecha */
    align-items: center;
    gap: 40px;
    position: relative;
    z-index: 1;
  }

  /* COLUMNA IMAGEN */
  .kh-media-col {
    width: 55%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 500px;
  }

  .kh-composite-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .kh-img {
    position: absolute;
    height: auto;
    object-fit: contain;
    animation: kh-float 6s ease-in-out infinite;
  }

  /* PRINCIPAL: A la IZQUIERDA según tu corrección */
  .kh-main-wrapper {
    position: relative;
    z-index: 10;
  }
  .kh-img--main {
    width: 400px;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    filter: drop-shadow(0 20px 40px rgba(0,0,0,0.15));
  }

  /* SECUNDARIA: A la DERECHA */
  .kh-secondary-wrapper {
    position: absolute;
    right: 0;
    top: 10%;
    z-index: 5;
  }
  .kh-img--secondary {
    width: 320px;
    opacity: 0.85;
    animation-delay: 1s;
  }

  /* COLUMNA TEXTO */
  .kh-text-col { width: 45%; }
  .kh-proof-badge { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
  .kh-stars { color: var(--star-color); display: flex; gap: 4px; }
  .kh-stars svg { width: 18px; height: 18px; }
  .kh-hero-title { font-size: 52px; font-weight: 700; line-height: 1.1; margin: 0; }
  .kh-static-text p { display: inline; margin: 0; }
  .kh-dynamic-wrapper { display: inline-block; }
  .kh-caret { border-right: 3px solid currentColor; animation: kh-blink 1s step-start infinite; }

  @keyframes kh-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
  }
  @keyframes kh-blink { 50% { border-color: transparent; } }

  /* RESPONSIVE */
  @media (max-width: 990px) {
    .kh-container { flex-direction: column; padding: 40px 20px; text-align: center; }
    .kh-media-col { width: 100%; min-height: 350px; }
    .kh-text-col { width: 100%; }
    .kh-img--main { width: 280px; left: 50%; transform: translateX(-70%); } /* Ajuste para que no se oculte */
    .kh-img--secondary { width: 200px; right: 50%; transform: translateX(70%); top: 0; }
    .kh-hero-title { font-size: 34px; }
    #kh-hero-{{ section.id }}::before {
      background: linear-gradient(0deg, var(--bg-grad) 40%, transparent 100%);
    }
  }

  @media (max-width: 480px) {
    .kh-img--main { width: 220px; transform: translateX(-60%); }
    .kh-img--secondary { width: 160px; transform: translateX(60%); }
    .kh-media-col { min-height: 280px; }
  }
</style>

<script>
  (function(){
    const el = document.getElementById("kh-typed-{{ section.id }}");
    if(!el) return;
    const words = [{% for block in section.blocks %}{{ block.settings.word | json }}{% unless forloop.last %},{% endunless %}{% endfor %}];
    if(!words.length) words=["natural"];
    let i=0, j=0, del=false;
    function tick(){
      let w = words[i];
      el.innerHTML = w.slice(0, j) || "&nbsp;";
      if(!del && j < w.length) { j++; setTimeout(tick, 120); }
      else if(del && j > 0) { j--; setTimeout(tick, 60); }
      else if(!del && j === w.length) { setTimeout(() => { del = true; tick(); }, 2000); }
      else { del = false; i = (i + 1) % words.length; setTimeout(tick, 400); }
    }
    tick();
  })();
</script>

{% schema %}
{
  "name": "Kallos · Hero Fixed",
  "settings": [
    { "type": "color", "id": "gradient_color", "label": "Color Principal", "default": "#AC9651" },
    { "type": "color", "id": "text_color", "label": "Color Texto", "default": "#FFFFFF" },
    { "type": "color", "id": "star_color", "label": "Color Estrellas", "default": "#AC9651" },
    { "type": "text", "id": "client_count", "label": "Clientes", "default": "10.000" },
    { "type": "text", "id": "client_text", "label": "Subtexto Clientes", "default": "clientes Kallos" },
    { "type": "image_picker", "id": "img_main", "label": "Imagen Principal (Izquierda)" },
    { "type": "image_picker", "id": "img_secondary", "label": "Imagen Secundaria (Derecha)" },
    { "type": "richtext", "id": "title_rich", "label": "Título Estático", "default": "<p>Más confianza, Más</p>" },
    { "type": "richtext", "id": "description_rich", "label": "Descripción" }
  ],
  "blocks": [
    {
      "type": "word",
      "name": "Palabra Animada",
      "settings": [{ "type": "text", "id": "word", "label": "Texto", "default": "cejas" }]
    }
  ],
  "presets": [{ "name": "Kallos · Hero Fixed" }]
}
{% endschema %}
